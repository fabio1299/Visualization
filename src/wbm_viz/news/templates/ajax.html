{% extends "base_temp.html" %}
{% comment "template_location" %}
    'ajax.html'
{% endcomment %}
{% load staticfiles %}
{% block content %}
    <form class='my-ajax-form' method='POST' action='.' data-url='{{ request.build_absolute_uri|safe }}'>
        {% csrf_token %}
        {{form.as_p|safe}}
        <button type='submit'>Submit</button>
    </form>
{% endblock content %}

{% block javascript %}
    {#    deal with csrf issues#}
    <script type="text/javascript" src="{% static "js/ajax_csrf.js" %}"></script>
    {#    ajax#}
    <script>
        $(document).ready(function(){
            var $myForm = $('.my-ajax-form')
            $myForm.submit(function(event){
                event.preventDefault()
                var $formData = $(this).serialize()
                var $thisURL = $myForm.attr('data-url') || window.location.href // or set your own url
                $.ajax({
                    method: "POST",
                    url: $thisURL,
                    data: $formData,
                    success: handleFormSuccess,
                    error: handleFormError,
                })
            })

            function handleFormSuccess(data, tzextStatus, jqXHR){
                console.log(data)
            }

            function handleFormError(jqXHR, textStatus, errorThrown){
                console.log(jqXHR)
            }
        })
    </script>
{% endblock %}