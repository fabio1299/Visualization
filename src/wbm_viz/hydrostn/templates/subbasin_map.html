{% extends "base.html" %}

    {% block title %} Subbasin {{ subbasin.id }} {% endblock %}

    {% load leaflet_tags %}
    {% leaflet_js %}
    {% leaflet_css %}

    {% block style %}
    <style>
        .map {
            height: 800px;
        }

        #subbasin_legend{
            border-color: {{ polygon_style.sub_border }};
            border-style: solid;
            background-color: {{ polygon_style.sub_fill }};
            width: 100px;
            height: 100px;
            display: inline-block;
        }

        #catchment_legend{
            border-color: {{ polygon_style.catch_border }};
            border-style: solid;
            background-color: {{ polygon_style.catch_fill }};
            width: 100px;
            height: 100px;
            display: inline-block;
        }
    </style>
    {% endblock %}

    {% block script %}
    <script type="text/javascript">
        const argentina_coords = [-38.4161, -63.6167]

        function catchment_style(feature){
            return {

                color : '{{ polygon_style.catch_border }}',
                opacity : 0.8,
                fillColor: '{{ polygon_style.catch_fill }}',
                fillOpacity: 0.2
            }
        }

        function subbasin_style(feature){
            return{
                color : '{{ polygon_style.sub_border }}',
                opacity : 0.8,
                fillColor: '{{ polygon_style.sub_fill }}',
                fillOpacity: 0.2
            }
        }

        function subbasin_map_init(map, options) {
            {#map.setView(argentina_coords, 3);#}

            const subbasin_polygon = L.geoJSON({{ subbasin.geom.geojson|safe }},{style: subbasin_style})
            const subbasin_catchment = L.geoJSON({{ catch_geom.geojson |safe }},{style: catchment_style})

            subbasin_catchment.addTo(map)
            subbasin_polygon.addTo(map)
            map.fitWorld()
            map.fitBounds(subbasin_catchment.getBounds())
        }

    </script>
{% endblock %}
</head>

{% block content %}
        <h2>Catchment for Subbasin {{ subbasin.id }}</h2>
        <div class="map" id="subbasin_map">
            {% leaflet_map "subbasin_map" callback="subbasin_map_init" %}
        </div>

    <div class="row">
        <div class="col-6">
            <h4>Subbasin</h4>
            <div id="subbasin_legend"></div>
            <p>
                Subbasin Stream Order: {{ subbasin.stream_order }}<br>
                Subbasin Perimeter: {{ subbasin.perimeter }}<br>
                Subbasin Area: {{ subbasin.grid_area }}<br>
            </p>
        </div>
        <div class="col-6">
            <h4>Catchment</h4>
            <div id="catchment_legend"></div>
            <p>Subbasin Catchment Area: {{ subbasin.stn_catchment_area }}</p>

        </div>
    </div>



{% endblock %}

